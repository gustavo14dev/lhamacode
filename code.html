<!DOCTYPE html>
<html lang="pt-BR"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Drekee AI 1</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3B82F6", // Blue accent color for the button
                        "background-light": "#F0F9FF", // Light blue background
                        "background-dark": "#0F172A", // Dark blue background
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#1E293B",
                        "text-main-light": "#1E293B", // Dark blue text
                        "text-main-dark": "#F8FAFC", // Light text for dark mode
                        "sidebar-light": "#F8FAFC",
                        "sidebar-dark": "#1E293B",
                    },
                    fontFamily: {
                        display: ["'Plus Jakarta Sans'", "sans-serif"],
                        sans: ["'Plus Jakarta Sans'", "sans-serif"],
                        inter: ["'Inter'", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                        'xl': '1rem',
                        '2xl': '1.5rem',
                        '3xl': '2rem',
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(59, 130, 246, 0.1)',
                        'input': '0 10px 40px -10px rgba(59, 130, 246, 0.15)',
                    }
                },
            },
        };
    </script>
<style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }.custom-bg {
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 50%, #DBEAFE 100%);
        }
        .dark .custom-bg {
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 50%, #334155 100%);
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease;
        }
        .animate-scaleIn {
            animation: scaleIn 0.3s ease;
        }
        .animate-slideIn {
            animation: slideIn 0.3s ease;
        }
        .animate-spin-slow {
            animation: spin-slow 2s linear infinite;
        }
        .input-wrapper-bottom {
            position: fixed !important;
            bottom: 1rem !important;
            top: auto !important;
            transform: none !important;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            will-change: transform, top, bottom;
        }
        .input-wrapper-center {
            position: fixed !important;
            top: 50% !important;
            bottom: auto !important;
            transform: translateY(-50%) !important;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            will-change: transform, top, bottom;
        }
        .pause-button {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px -8px rgba(59, 130, 246, 0.4);
            transition: all 0.2s ease;
        }
        .pause-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px -8px rgba(59, 130, 246, 0.6);
        }
        .pause-button:active {
            transform: scale(0.95);
        }
        /* Esconder scrollbar mas permitir scroll */
        #debugModalContent {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        #debugModalContent::-webkit-scrollbar {
            display: none;
        }
        
        /* For√ßar tema escuro */
        html, body {
            background: #0f172a !important;
            color: #e2e8f0 !important;
        }
        
        .custom-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
        }
        
        /* For√ßar cores do tema escuro */
        .text-text-main-light {
            color: #e2e8f0 !important;
        }
        
        .bg-sidebar-light\/95 {
            background: rgba(30, 41, 59, 0.95) !important;
        }
        
        .bg-surface-light {
            background: #1e293b !important;
        }
        
        /* Remover cores do tema claro */
        .bg-white\/5 {
            background: rgba(255, 255, 255, 0.05) !important;
        }
    </style>
</head>
<body class="custom-bg min-h-screen text-text-main-light dark:text-text-main-dark transition-colors duration-300 dark">
<nav class="fixed left-4 top-4 bottom-4 w-72 bg-sidebar-light/95 dark:bg-sidebar-dark/95 backdrop-blur-md rounded-[2rem] flex flex-col py-6 px-4 shadow-soft z-50 border border-white/50 dark:border-white/10 transition-colors duration-300">
<div class="mb-8 px-2 flex items-center gap-3">
    <video autoplay muted loop playsinline class="w-8 h-8 rounded-full object-cover">
        <source src="img/Video Project.mp4" type="video/mp4">
    </video>
    <div class="flex items-center gap-3">
        <span class="text-xl font-bold tracking-tight text-text-main-light dark:text-text-main-dark">Drekee AI</span>
        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-primary text-white tracking-wider">BETA 1</span>
    </div>
</div>
<button class="flex items-center gap-3 w-full p-3 mb-6 rounded-xl bg-surface-light dark:bg-white/5 border border-gray-100 dark:border-white/5 shadow-sm hover:shadow-md transition-all group text-left" id="newChatBtn">
<span class="material-icons-outlined text-primary group-hover:scale-110 transition-transform">add_circle</span>
<span class="font-semibold text-gray-700 dark:text-gray-200">Novo Chat</span>
</button>
<div class="flex-1 overflow-y-auto no-scrollbar flex flex-col gap-4 px-1">
<div>
<h3 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3 pl-2">Suas Conversas</h3>
<div class="flex flex-col gap-1.5" id="chatHistoryList">
<div class="text-xs text-gray-400 dark:text-gray-500 px-3 py-6 text-center">Nenhuma conversa recente</div>
</div>
</div>
</div>
</nav>
<main class="ml-80 min-h-screen flex flex-col relative" id="mainContainer">

<!-- API Status Banner: exibido quando as ENV das APIs n√£o est√£o configuradas ou /api/status falha -->
<div id="apiStatusBanner" class="fixed right-6 top-20 z-50 hidden bg-yellow-50 dark:bg-yellow-900 text-yellow-900 dark:text-yellow-100 border border-yellow-200 dark:border-yellow-700 rounded-lg px-4 py-2 shadow-sm max-w-md"></div>

<div class="flex-1 flex flex-col justify-end px-4 md:px-12 pb-20 max-w-4xl mx-auto" id="welcomeScreen">
<div class="max-w-6xl text-center mb-8 flex flex-col items-center transition-opacity duration-500" id="titleSection">
<video autoplay muted loop playsinline class="w-32 h-32 rounded-none object-cover">
        <source src="img/Video Project.mp4" type="video/mp4">
    </video>
<h1 class="text-4xl md:text-5xl lg:text-6xl font-medium tracking-tight text-white leading-[1.1] font-inter">
            Como posso ajudar? 
        </h1>
</div>
</div>

<div class="flex-1 overflow-y-auto px-4 md:px-12 pt-8 pb-52" id="chatArea">
<div class="max-w-4xl mx-auto w-full" id="messagesContainer"></div>
</div>

<div class="fixed top-1/2 left-80 right-0 transform -translate-y-1/2 px-4 md:px-12 z-50 input-wrapper-center" id="inputWrapper">
<div class="max-w-4xl mx-auto w-full">
<div class="bg-surface-light dark:bg-surface-dark rounded-[2rem] p-4 shadow-input border border-white/60 dark:border-white/5 transition-all duration-300">
<!-- Container para mostrar arquivos anexados (posicionado acima da caixa de texto) -->
<div id="attachedFilesContainer" class="mb-3 w-full hidden"></div>

<textarea class="w-full bg-transparent border-none text-gray-600 dark:text-gray-300 text-lg placeholder-gray-400 dark:placeholder-gray-500 focus:ring-0 resize-none h-12 py-2 px-2" placeholder="Como posso ajudar com seu c√≥digo hoje?" id="userInput"></textarea>
<div class="flex flex-col sm:flex-row items-center justify-between gap-4 mt-2 px-2 pb-1">
<div class="flex items-center gap-3 w-full sm:w-auto overflow-x-auto no-scrollbar">
<!-- V√≠deo animado ao lado do bot√£o de anexo -->
<video id="inputVideo" autoplay muted loop playsinline class="w-10 h-10 rounded-lg object-cover hidden cursor-pointer hover:scale-105 transition-transform" style="display: none;" onclick="showBiluCard()" title="Clique para ver a fam√≠lia Bilu">
    <source src="img/Video Project.mp4" type="video/mp4">
</video>
<button id="attachFileBtn" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/5 text-gray-600 dark:text-gray-300 transition-colors" title="Anexar arquivo">
<span class="material-icons-outlined text-base">attach_file</span>
</button>
<input type="file" id="fileInput" class="hidden" multiple />
</div>
<div class="flex items-center gap-2 ml-auto">
<div class="relative" id="modelSelectorContainer">
<button class="flex items-center gap-2 px-3 py-1.5 rounded-full border border-gray-200 dark:border-gray-700 text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors" id="modelButton">
<span class="material-icons-outlined text-base">psychology</span>
<span id="modelButtonText">Racioc√≠nio</span>
<span class="material-icons-outlined text-sm">expand_more</span>
</button>
</div>
<button class="w-10 h-10 rounded-full bg-primary hover:bg-primary/90 flex items-center justify-center text-white shadow-lg shadow-blue-500/30 transition-all transform hover:scale-105 active:scale-95" id="sendButton">
<span class="material-icons-outlined text-xl">arrow_upward</span>
</button>
</div>

</div>
</div>

<!-- Bot√£o de scroll para baixo -->
<button class="absolute bottom-24 right-6 w-12 h-12 rounded-full bg-primary hover:bg-primary/90 text-white shadow-lg shadow-blue-500/30 transition-all transform hover:scale-110 active:scale-95 opacity-0 pointer-events-none animate-fadeIn" id="scrollToBottomBtn" title="Voltar para mensagem mais recente">
<span class="material-icons-outlined text-xl">arrow_downward</span>
</button>
</div>
</div>

<!-- Card de Erro de API -->
<div id="apiErrorCard" class="fixed inset-0 z-50 hidden bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 animate-fadeIn pointer-events-none">
    <div class="bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800 rounded-xl shadow-2xl max-w-md w-full animate-scaleIn pointer-events-auto p-6">
        <!-- Header -->
        <div class="text-center mb-4">
            <div class="w-16 h-16 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-icons-outlined text-3xl text-red-600 dark:text-red-400">close</span>
            </div>
            <h2 class="text-xl font-bold text-red-900 dark:text-red-100 mb-2">Foi eu, n√£o voc√™...</h2>
            <p class="text-red-700 dark:text-red-300 mb-4">Ocorreu um erro no nosso sistema</p>
            <p class="text-sm text-red-600 dark:text-red-400" id="retryMessage">Tentando novamente em 10 segundos...</p>
        </div>
        
        <!-- Loading indicator -->
        <div class="flex justify-center mb-4">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-red-600"></div>
        </div>
        
        <!-- Footer -->
        <div class="text-center">
            <button onclick="cancelApiRetry()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-sm">
                Cancelar
            </button>
        </div>
    </div>
</div>

<!-- Card da Fam√≠lia Bilu -->
<div id="biluFamilyCard" class="fixed inset-0 z-50 hidden bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 animate-fadeIn pointer-events-none" onclick="if(event.target === this) { hideBiluCard(); }">
    <div class="bg-white dark:bg-gray-950 rounded-xl border border-gray-200 dark:border-gray-800 shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-scaleIn pointer-events-auto p-6">
        <!-- Header -->
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Essa √© a fam√≠lia Bilu</h2>
        </div>
        
        <!-- Grid de V√≠deos -->
        <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mb-6">
            <!-- V√≠deo 1: Bilu (existente) -->
            <div class="video-slot">
                <video autoplay muted loop playsinline class="w-full h-32 object-cover rounded-lg cursor-pointer hover:scale-105 transition-transform" onclick="selectBiluVideo('img/Video Project.mp4', 'Bilu')">
                    <source src="img/Video Project.mp4" type="video/mp4">
                </video>
                <p class="text-xs text-center mt-1 text-gray-600 dark:text-gray-400">Bilu</p>
            </div>
            
            <!-- V√≠deo 2: Kino (novo) -->
            <div class="video-slot">
                <video autoplay muted loop playsinline class="w-full h-32 object-cover rounded-lg cursor-pointer hover:scale-105 transition-transform" onclick="selectBiluVideo('img/Video Project2.mp4', 'Kino')">
                    <source src="img/Video Project2.mp4" type="video/mp4">
                </video>
                <p class="text-xs text-center mt-1 text-gray-600 dark:text-gray-400">Kino</p>
            </div>
            
            <!-- V√≠deos 3-6: Placeholders -->
            <div class="video-slot">
                <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                    <span class="material-icons-outlined text-gray-400 dark:text-gray-500">add_circle_outline</span>
                </div>
                <p class="text-xs text-center mt-1 text-gray-600 dark:text-gray-400">Vazio</p>
            </div>
            <div class="video-slot">
                <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                    <span class="material-icons-outlined text-gray-400 dark:text-gray-500">add_circle_outline</span>
                </div>
                <p class="text-xs text-center mt-1 text-gray-600 dark:text-gray-400">Vazio</p>
            </div>
            <div class="video-slot">
                <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                    <span class="material-icons-outlined text-gray-400 dark:text-gray-500">add_circle_outline</span>
                </div>
                <p class="text-xs text-center mt-1 text-gray-600 dark:text-gray-400">Vazio</p>
            </div>
            <div class="video-slot">
                <div class="w-full h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                    <span class="material-icons-outlined text-gray-400 dark:text-gray-500">add_circle_outline</span>
                </div>
                <p class="text-xs text-center mt-1 text-gray-600 dark:text-gray-400">Vazio</p>
            </div>
        
        <!-- Footer -->
        <div class="text-center">
            <button onclick="hideBiluCard()" class="px-6 py-2 bg-primary hover:bg-primary/90 text-white rounded-full font-medium transition-colors">
                Fechar
            </button>
        </div>
    </div>
</div>
</main>

<script type="module" src="main.js" defer></script>
<script>
// For√ßar tema escuro em qualquer computador
document.addEventListener('DOMContentLoaded', function() {
    // Adicionar classe 'dark' ao HTML para for√ßar tema escuro
    document.documentElement.classList.add('dark');
    
    // Tamb√©m for√ßar no body
    document.body.classList.add('dark');
    
    // Salvar prefer√™ncia no localStorage
    localStorage.setItem('theme', 'dark');
    
    console.log('üåô Tema escuro for√ßado com sucesso!');
});
</script>
<script>
// Vari√°veis globais para controle de retry
window.apiRetryTimeout = null;
window.apiRetryCount = 0;
window.lastFailedMessage = null;
window.lastFailedFiles = null;

// Fun√ß√µes para o card de erro de API
function showApiErrorCard() {
    const card = document.getElementById('apiErrorCard');
    if (card) {
        card.classList.remove('hidden');
        card.classList.remove('pointer-events-none');
    }
}

function hideApiErrorCard() {
    const card = document.getElementById('apiErrorCard');
    if (card) {
        card.classList.add('hidden');
        card.classList.add('pointer-events-none');
    }
}

function cancelApiRetry() {
    if (window.apiRetryTimeout) {
        clearTimeout(window.apiRetryTimeout);
        window.apiRetryTimeout = null;
    }
    hideApiErrorCard();
    window.apiRetryCount = 0;
    window.lastFailedMessage = null;
    window.lastFailedFiles = null;
}

function updateRetryMessage(seconds) {
    const messageEl = document.getElementById('retryMessage');
    if (messageEl) {
        messageEl.textContent = `Tentando novamente em ${seconds} segundos...`;
    }
}

function scheduleApiRetry(message, files) {
    // Salvar a √∫ltima tentativa falha
    window.lastFailedMessage = message;
    window.lastFailedFiles = files;
    
    // Calcular tempo de espera (10s, 1m20s, 2m30s, etc)
    let waitTime;
    if (window.apiRetryCount === 0) {
        waitTime = 10000; // 10 segundos
    } else {
        waitTime = 80000 * (window.apiRetryCount + 1); // 1m20s, 2m40s, 4m, etc
    }
    
    // Mostrar o card
    showApiErrorCard();
    
    // Countdown
    let remainingSeconds = Math.floor(waitTime / 1000);
    updateRetryMessage(remainingSeconds);
    
    const countdownInterval = setInterval(() => {
        remainingSeconds--;
        updateRetryMessage(remainingSeconds);
        if (remainingSeconds <= 0) {
            clearInterval(countdownInterval);
        }
    }, 1000);
    
    // Agendar retry
    window.apiRetryTimeout = setTimeout(() => {
        clearInterval(countdownInterval);
        hideApiErrorCard();
        window.apiRetryCount++;
        
        // Tentar novamente
        if (window.ui && window.ui.agent) {
            window.ui.agent.processMessage(message, files).catch(error => {
                console.error('Retry failed:', error);
                scheduleApiRetry(message, files); // Tentar novamente
            });
        }
    }, waitTime);
}

// Expor fun√ß√µes globalmente para o agent.js poder acessar
window.showApiErrorCard = showApiErrorCard;
window.hideApiErrorCard = hideApiErrorCard;
window.cancelApiRetry = cancelApiRetry;
window.updateRetryMessage = updateRetryMessage;
window.scheduleApiRetry = scheduleApiRetry;

// Expor sistema de mem√≥ria globalmente
window.memoryStats = () => {
    if (window.ui && window.ui.agent && window.ui.agent.memory) {
        const stats = window.ui.agent.memory.getMemoryStats();
        console.log('üß† Estat√≠sticas da Mem√≥ria:', stats);
        return stats;
    }
};

window.clearMemory = () => {
    if (window.ui && window.ui.agent && window.ui.agent.memory) {
        window.ui.agent.memory.clearMemory();
        console.log('üßπ Mem√≥ria limpa com sucesso!');
    }
};

window.showMemory = () => {
    if (window.ui && window.ui.agent && window.ui.agent.memory) {
        const memory = window.ui.agent.memory;
        console.log('üß† Mem√≥ria da Conversa:', memory.conversationMemory);
        console.log('üë§ Mem√≥ria do Usu√°rio:', memory.userMemory);
        console.log('üìÅ Mem√≥ria de Projetos:', memory.projectMemory);
    }
};

// Fun√ß√µes globais para o card da fam√≠lia Bilu (definidas antes de qualquer uso)
function showBiluCard() {
    const card = document.getElementById('biluFamilyCard');
    if (card) {
        card.classList.remove('hidden');
        card.classList.remove('pointer-events-none');
    }
}

function hideBiluCard() {
    const card = document.getElementById('biluFamilyCard');
    if (card) {
        card.classList.add('hidden');
        card.classList.add('pointer-events-none');
    }
}

function selectBiluVideo(videoPath, characterName) {
    // Atualizar o v√≠deo do input
    const inputVideo = document.getElementById('inputVideo');
    if (inputVideo) {
        inputVideo.querySelector('source').src = videoPath;
        // N√£o chamar load() para n√£o interromper a reprodu√ß√£o cont√≠nua
    }
    
    // Fechar o card
    hideBiluCard();
    
    // Mostrar o v√≠deo (se j√° estiver na tela de chat)
    showInputVideo();
}

// L√≥gica para mover a caixa de input para baixo quando enviar mensagem
document.addEventListener('DOMContentLoaded', function() {
    const inputWrapper = document.getElementById('inputWrapper');
    const sendButton = document.getElementById('sendButton');
    const userInput = document.getElementById('userInput');
    let hasMovedDown = false;
    
    function moveInputDown() {
        if (!hasMovedDown) {
            inputWrapper.classList.remove('input-wrapper-center');
            inputWrapper.classList.add('input-wrapper-bottom');
            hasMovedDown = true;
        }
    }
    
    function moveInputUp() {
        if (hasMovedDown) {
            inputWrapper.classList.remove('input-wrapper-bottom');
            inputWrapper.classList.add('input-wrapper-center');
            hasMovedDown = false;
        }
    }
    
        
    // Fun√ß√£o para rolar para a mensagem mais recente
    function scrollToBottom() {
        const messagesContainer = document.getElementById('messagesContainer');
        if (messagesContainer) {
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }
    }
    
    // Fun√ß√£o para rolar suavemente para o final
    function smoothScrollToBottom() {
        const messagesContainer = document.getElementById('messagesContainer');
        if (messagesContainer) {
            setTimeout(() => {
                messagesContainer.scrollTo({
                    top: messagesContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }
    }
    
    // Observer para detectar novas mensagens
    function setupMessageObserver() {
        const messagesContainer = document.getElementById('messagesContainer');
        if (messagesContainer) {
            const observer = new MutationObserver((mutations) => {
                let shouldScroll = false;
                
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        // Verifica qualquer n√≥ adicionado que n√£o seja apenas texto
                        Array.from(mutation.addedNodes).forEach(node => {
                            if (node.nodeType === 1) { // Element node
                                shouldScroll = true;
                            }
                        });
                    }
                });
                
                if (shouldScroll) {
                    setTimeout(smoothScrollToBottom, 100);
                }
            });
            
            observer.observe(messagesContainer, {
                childList: true,
                subtree: true,
                attributes: false,
                characterData: false
            });
        }
    }
    
    // Fallback: verificar periodicamente se h√° novas mensagens
    let lastMessageCount = 0;
    function checkForNewMessages() {
        const messagesContainer = document.getElementById('messagesContainer');
        if (messagesContainer) {
            const currentCount = messagesContainer.children.length;
            if (currentCount > lastMessageCount) {
                smoothScrollToBottom();
                lastMessageCount = currentCount;
            }
        }
    }
    
    // Verificar a cada 500ms durante os primeiros 10 segundos de atividade
    let checkInterval;
    function startPeriodicCheck() {
        checkInterval = setInterval(checkForNewMessages, 500);
        setTimeout(() => {
            clearInterval(checkInterval);
        }, 10000);
    }
    
    // Configurar observer quando a p√°gina carregar
    setupMessageObserver();
    
    // Fun√ß√£o para mostrar o v√≠deo ao lado do anexo
    function showInputVideo() {
        const video = document.getElementById('inputVideo');
        if (video) {
            video.style.display = 'block';
            video.classList.remove('hidden');
        }
    }
    
        
    // Fun√ß√£o para esconder o v√≠deo
    function hideInputVideo() {
        const video = document.getElementById('inputVideo');
        if (video) {
            video.style.display = 'none';
            video.classList.add('hidden');
        }
    }
    
    // Rolar para baixo quando enviar mensagem
    if (sendButton) {
        sendButton.addEventListener('click', function() {
            setTimeout(moveInputDown, 50);
            setTimeout(smoothScrollToBottom, 200);
            setTimeout(showInputVideo, 100); // Mostrar v√≠deo ap√≥s enviar
            startPeriodicCheck(); // Ativar verifica√ß√£o peri√≥dica
        });
    }
    
    // Rolar para baixo quando pressionar Enter
    if (userInput) {
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                setTimeout(moveInputDown, 50);
                setTimeout(smoothScrollToBottom, 200);
                setTimeout(showInputVideo, 100); // Mostrar v√≠deo ap√≥s enviar
                startPeriodicCheck(); // Ativar verifica√ß√£o peri√≥dica
            }
        });
    }
    
    // Opcional: voltar para cima se n√£o houver mensagens
    // Isso pode ser implementado depois quando tivermos a l√≥gica de mensagens
});
</script>
</body>
</html>
